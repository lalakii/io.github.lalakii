const postForm=document.getElementById("postForm");function imageChoose(e,o){let t="";switch(e){case 0:t=o;break;case 1:t='<img src="'+o+'" alt="laji">';break;case 2:t="![laji]("+o+")";break;case 3:t="[url="+location.origin+"][img]"+o+"[/img][/url]";break;case 4:t="!"+o+"!";break;case 5:t="image::"+o+"["+location.origin+"]"}document.getElementById("imgURI").value=t}function uploading(){window.progressVal=0,document.getElementById("progressBar").style.display="block",window.lalakiProgressHandle=setInterval((function(){document.querySelector(".progress-value").style.width=window.progressVal+"%",100==window.progressVal&&(window.progressVal=0),window.progressVal+=5}),30)}function logout(){fetch("/?tag=quit").then((e=>{401==e.status&&location.reload()}))}function show_sys_info(){let e=document.getElementById("sysinfo");e.style.display="inline-block"==e.style.display?"none":"inline-block"}window.mSelectIndex=0,window.lalakiProgressHandle=null,window.onload=()=>{if(null==localStorage.getItem("accept_cookies")){const e=document.querySelector("#la_cookies");e.removeAttribute("hidden"),document.querySelector("#la_cookies_ok").onclick=()=>{e.setAttribute("hidden","hidden"),localStorage.setItem("accept_cookies","1")}}if(document.querySelector(".btn-copy").onclick=function(){let e=document.getElementById("imgURI");e.select();let o=e.value;e.setSelectionRange(0,o.length);try{document.execCommand("copy")}catch(e){}navigator.clipboard.writeText(o)},/(weixin|wechat)/i.test(navigator.userAgent))return void alert("WeChat built-in browser is not supported.");document.getElementById("fileSelect").onchange=function(e){let o=document.querySelector(".btn-upload");o.setAttribute("for",""),o.innerHTML="Uploading...",document.getElementById("imgURI").value="",uploading(),fetch(postForm.action,{method:"POST",body:new FormData(postForm)}).then((e=>e.json())).then((e=>{let t=e.insert;if("isApkPublishOK"==t){let o=e.msg,t=e.name+" 发布成功！\n\nSHA256: "+e.sha256;null!=o&&null!=o&&(t+="\n\n"+o),alert(t)}else if(t>=0){let o=location.origin+"/laji/"+e.crc32+".JPEG";window.lalakiJPEGURI=o,imageChoose(window.mSelectIndex,window.lalakiJPEGURI)}else-2==t?alert("Not logged in or incorrect password."):-6==t&&alert("Upload failed, please try again!");setTimeout((function(){document.getElementById("progressBar").style.display="none",null!=window.lalakiProgressHandle&&(clearInterval(window.lalakiProgressHandle),window.lalakiProgressHandle=null,o.setAttribute("for","fileSelect"),o.innerHTML="Upload files",document.getElementById("fileSelect").value="")}),500)}))};const e=document.querySelector(".combox");document.getElementById("mCombox").onclick=function(){if("none"==e.style.display){e.style.display="inline-block";let o=document.querySelector("#mCombox span"),t=o.offsetLeft+(o.offsetWidth-e.offsetWidth)/2;document.querySelector(".combox-parent").style.left=t+"px"}else e.style.display="none"},document.querySelectorAll(".combox li").forEach((e=>{e.onclick=function(e){let o=e.target.innerHTML,t=-1;document.querySelector("#mCombox span").innerHTML=o,document.querySelectorAll(".combox li").forEach(((e,n)=>{e.innerText==o?(window.mSelectIndex=t=n,e.setAttribute("hidden","hidden")):e.removeAttribute("hidden")})),null!=window.lalakiJPEGURI&&null!=window.lalakiJPEGURI&&imageChoose(t,window.lalakiJPEGURI)}})),window.onresize=function(){e.style.display="none"}};